<!DOCTYPE HTML><html><head>    <meta charset="UTF-8">    <meta content="weiphp,互联网+,微信开源开发框架" name="keywords"/>    <meta content="weiphp是互联网+的IT综合解决方案" name="description"/>    <link rel="shortcut icon" href="http://weixin.abis.com.cn/favicon.ico">    <title>fds</title>    <link href="css/font-awesome.min.css?v=1470986660" rel="stylesheet">    <link href="css/base.css?v=1470986660" rel="stylesheet">    <link href="css/module.css?v=1470986660" rel="stylesheet">    <link href="css/twsc.css?v=1470986660" rel="stylesheet">    <link href="css/emoji.css?v=1470986660" rel="stylesheet">    <!--[if lt IE 9]>    <script type="text/javascript" src="/Public/static/jquery-1.10.2.min.js"></script>    <![endif]-->    <!--[if gte IE 9]><!-->    <script type="text/javascript" src="js/jquery-2.0.3.min.js"></script>    <!--<![endif]-->    <script type="text/javascript" src="js/bootstrap.min.js"></script>    <script type="text/javascript" src="js/jquery.uploadify.min.js"></script>    <script type="text/javascript" src="js/ZeroClipboard.min.js?v=1470986660"></script>    <script type="text/javascript" src="js/dialog.js?v=1470986660"></script>    <script type="text/javascript" src="js/admin_common.js?v=1470986660"></script>    <script type="text/javascript" src="js/admin_image.js?v=1470986660"></script>    <script type="text/javascript" src="js/masonry.pkgd.min.js"></script>    <script type="text/javascript" src="js/jquery.dragsort-0.5.2.min.js"></script></head><body><div id="form" action="http://weixin.abis.com.cn/index.php?s=/Home/Material/doAdd/group_id/0.html"     class="form-horizontal form-center">    <div class="material_form">        <div class="preview_area">            <form data-index='0' class="appmsg_item edit_item editing">                <p class="time">时间</p>                <div class="main_img">                    <img src="images/no_cover_pic.png" data-coverid="0"/>                    <h6 class="title">这是标题</h6>                </div>                <p class="intro"></p>                <input type="hidden" name="title" placeholder="这是标题"/>                <input type="hidden" name="cover_id" value="0"/>                <input type="hidden" name="intro" placeholder="这是摘要描述"/>                <input type="hidden" name="author" placeholder="作者"/>                <input type="hidden" name="link" placeholder="外链"/>                <textarea style="display:none" name="content"></textarea>                <div class="hover_area"><a href="javascript:;" onClick="editItem(this)">编辑</a></div>            </form>            <div class="appmsg_edit_action">                <a href="javascript:;" onClick="addMsg();">添加</a>            </div>        </div>        <div class="edit_area">            <em class="area_arrow"></em>            <div class="">                <ul class="tab-pane in appmsg_edit_group">                    <li class="form-item cf">                        <label class="item-label"><span class="need_flag">*</span>标题<span                                class="check-tips"></span></label>                        <div class="controls">                            <input type="text" class="text input-large" name="p_title" value="">                        </div>                    </li>                    <li class="form-item cf">                        <label class="item-label">作者<span class="check-tips"></span></label>                        <div class="controls">                            <input type="text" class="text input-large" name="p_author" value="">                        </div>                    </li>                    <li class="form-item cf">                        <label class="item-label"><span class="need_flag">*</span>封面图片<span                                class="check-tips">图片<span                                class="picSize">900X500</span></span></label>                        <div class="controls uploadrow2" data-max="1" title="点击修改图片" rel="p_cover">                            <input type="file" id="upload_picture_p_cover">                            <input type="hidden" name="p_cover" id="cover_id_p_cover"                                   data-callback="uploadImgCallback" value=""/>                            <div class="upload-img-box" rel="img" style="display:none">                                <div class="upload-pre-item2"><img width="100" height="100" src=""/>                                </div>                                <em class="edit_img_icon">&nbsp;</em>                            </div>                        </div>                    </li>                    <li class="form-item cf">                        <label class="item-label">摘要<span class="check-tips"></span></label>                        <div class="controls">                            <label class="textarea input-large">                                <textarea class="text input-large" name="p_intro"></textarea>                            </label>                        </div>                    </li>                    <li class="form-item cf">                        <label class="item-label">正文<span                                class="check-tips">图片命名不能有特殊符号</span></label>                        <div class="controls">                            <label class="textarea">                                                    <textarea style="width:405px; height:200px;"                                                              name="p_content"></textarea>                                <input type="hidden" name="parse" value="0">                                <script type="text/javascript" charset="utf-8"                                        src="js/ueditor.config.js?v=1470986660"></script>                                <script type="text/javascript" charset="utf-8"                                        src="js/ueditor.all.js?v=1470986660"></script>                                <script type="text/javascript" charset="utf-8"                                        src="js/zh-cn.js?v=1470986660"></script>                                <script type="text/javascript">                                    $('textarea[name="p_content"]').attr('id', 'editor_id_p_content');                                    window.UEDITOR_HOME_URL = "/Public/static/ueditor";                                    window.UEDITOR_CONFIG.initialFrameHeight = parseInt('500px');                                    window.UEDITOR_CONFIG.scaleEnabled = true;                                    window.UEDITOR_CONFIG.imageUrl = 'http://weixin.abis.com.cn/index.php?s=/plugin/EditorForAdmin/Upload/ue_upimg.html';                                    window.UEDITOR_CONFIG.imagePath = '';                                    window.UEDITOR_CONFIG.imageFieldName = 'imgFile';                                    //在这里扫描图片                                    window.UEDITOR_CONFIG.imageManagerUrl = 'http://weixin.abis.com.cn/index.php?s=/plugin/EditorForAdmin/Upload/ue_mgimg.html';//图片在线管理的处理地址                                    window.UEDITOR_CONFIG.imageManagerPath = '';                                    var imageEditor = UE.getEditor('editor_id_p_content', {                                        toolbars: [                                            ['fullscreen', 'source', 'undo', 'redo',                                                'bold', 'italic', 'underline', 'fontborder', 'strikethrough', 'removeformat', 'formatmatch', 'autotypeset', 'blockquote', 'forecolor', 'backcolor', 'insertorderedlist', 'insertunorderedlist', 'selectall',                                                'lineheight',                                                'customstyle', 'paragraph', 'fontfamily', 'fontsize', 'indent',                                                'justifyleft', 'justifycenter', 'justifyright',                                                'link', 'unlink', 'insertimage', 'wordimage', 'emotion', 'attachment', 'map']                                        ],                                        autoHeightEnabled: false,                                        autoFloatEnabled: true,                                        initialFrameHeight: 300,                                        catchRemoteImageEnable: false                                    });                                    imageEditor.styleUrl = "http://weixin.abis.com.cn/index.php?s=/plugin/EditorForAdmin/Style/get_article_style.html";                                    //添加一下判断是否是单个按钮管理图片 需要执行一下代码                                </script>                                <script type="text/javascript" charset="utf-8"                                        src="js/main.js?v=1470986660"></script>                            </label>                            </label>                        </div>                    </li>                    <li class="form-item cf">                        <label class="item-label">外链<span class="check-tips"></span></label>                        <div class="controls">                            <input type="text" class="text input-large" name="p_link" value="">                        </div>                    </li>                </ul>            </div>        </div>    </div>    <div class="form-item form_bh">        <button class="btn submit-btn ajax-post" id="submit" type="button">确 定</button>    </div></div><script type="text/javascript">    (function () {        var ThinkPHP = window.Think = {            "ROOT": "", //当前网站地址            "APP": "/index.php?s=", //当前项目地址            "PUBLIC": "/Public", //项目公共目录地址            "DEEP": "/", //PATHINFO分割符            "MODEL": ["3", "", "html"],            "VAR": ["m", "c", "a"]        }    })();</script><script type="text/javascript">    $('#submit').click(function () {        var postUrl = $('#form').attr('action');        var dataJson = [];        $('.edit_item').each(function (index, element) {            dataJson.push($(this).serializeArray());        });        $(this).addClass('disabled');        //console.log(dataJson);        //console.log(JSON.stringify(dataJson));        //提交数组字符串 php解析后进行保存        $.post(postUrl, {'dataStr': JSON.stringify(dataJson)}, function (data) {            $('#submit').removeClass('disabled');            if (data.status == 1) {                updateAlert(data.info, 'success');                setTimeout(function () {                    location.href = data.url;                }, 1500);            } else {                updateAlert(data.info);            }        })        return false;    });    $(function () {        //初始化上传图片插件        initUploadImg();        showTab();        $('.toggle-data').each(function () {            var data = $(this).attr('toggle-data');            if (data == '') return true;            if ($(this).is(":selected") || $(this).is(":checked")) {                change_event(this)            }        });        $('select').change(function () {            $('.toggle-data').each(function () {                var data = $(this).attr('toggle-data');                if (data == '') return true;                if ($(this).is(":selected") || $(this).is(":checked")) {                    change_event(this)                }            });        });        //动态预览        $('input[name="p_title"]').keyup(function () {            $('.editing').find('.title').text($(this).val());            $('.editing').find('input[name="title"]').val($(this).val());        });        $('input[name="p_author"]').keyup(function () {            $('.editing').find('.author').text($(this).val());            $('.editing').find('input[name="author"]').val($(this).val());        });        $('input[name="p_link"]').keyup(function () {            $('.editing').find('.link').text($(this).val());            $('.editing').find('input[name="link"]').val($(this).val());        });        $('textarea[name="p_intro"]').keyup(function () {            $('.editing').find('.intro').text($(this).val());            $('.editing').find('input[name="intro"]').val($(this).val());        });        imageEditor.addListener("contentChange", function () {            $('.editing').find('textarea[name="content"]').val(imageEditor.getContent());        });        imageEditor.addListener("ready", function () {            initForm($('.edit_item').eq(0));        });    });    function addMsg() {        var curCount = $('.edit_item').size();        if (curCount >= 8) {            updateAlert('你最多只可以增加8条图文信息');            return false;        }        $('.picSize').text('200X200');        //console.log(curCount);        var addHtml = $('<form data-index="' + curCount + '" class="appmsg_sub_item edit_item">' +                '<p class="title"></p>' +                '<div class="main_img">' +                '<img src="images/no_cover_pic_s.png" data-coverid="0"/>' +                '</div>' +                '<input type="hidden" name="title" placeholder="这是标题"/>' +                '<input type="hidden" name="cover_id" value="0"/>' +                '<input type="hidden" name="intro" placeholder="这是摘要描述"/>' +                '<input type="hidden" name="author" placeholder="作者"/>' +                '<input type="hidden" name="link" placeholder="外链"/>' +                '<textarea style="display:none" name="content"></textarea>' +                '<div class="hover_area"><a href="javascript:;" onClick="editItem(this)">编辑</a><a href="javascript:;" onClick="deleteItem(this)">删除</a></div>' +                '</form>');        addHtml.insertBefore($('.appmsg_edit_action'));    }    function editItem(_this) {        $(_this).parents('.edit_item').addClass('editing');        $(_this).parents('.edit_item').siblings().removeClass('editing');        var index = $(_this).parents('.edit_item').data('index');        if (index == 0) {            $('.picSize').text('900X500');            $('.edit_area').css('margin-top', 0);        } else {            $('.picSize').text('200X200');            $('.edit_area').css('margin-top', index * 110 + 120);        }        initForm($(_this).parents('.edit_item'));    }    function deleteItem(_this) {        if (!confirm('确认删除？')) return false;        var item_id = $(_this).parents('.edit_item').find('input[name="id"]').val();        if (item_id) {            $.post("http://weixin.abis.com.cn/index.php?s=/Home/Material/del_material_by_id.html", {id: item_id});        }        $(_this).parents('.edit_item').remove();        var curCount = $('.edit_item').size();        if (curCount == 1) {            $('.edit_area').css('margin-top', 0);        } else {            $('.edit_area').css('margin-top', (curCount - 1) * 110 + 120);        }        initForm($('.edit_item').eq(curCount - 1));    }    function uploadImgCallback(name, id, src) {        $('.editing img').attr('src', src);        $('.editing input[name="cover_id"]').val(id);    }    function initForm(_item) {        var title = $(_item).find('input[name="title"]').val();        var author = $(_item).find('input[name="author"]').val();        var link = $(_item).find('input[name="link"]').val();        var intro = $(_item).find('input[name="intro"]').val();        var content = $(_item).find('textarea[name="content"]').val();        var src = $(_item).find('img').attr('src');        $('input[name="p_title"]').val(title);        $('input[name="p_author"]').val(author);        $('input[name="p_link"]').val(link);        $('textarea[name="p_intro"]').val(intro);        if (!content)content = " ";        if (content) {            imageEditor.setContent(content);        }        $('.upload-img-box').show().find('img').attr('src', src);    }</script></body></html>